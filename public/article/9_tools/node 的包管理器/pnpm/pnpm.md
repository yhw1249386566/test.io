# .pnpm 如何安装依赖?

安装包时, 会将包本身, 包括包的所有依赖摊平到 `node_modules/.pnpm` 文件夹中, 其文件名字:

- `包名@版本号`
  => `locate-path@6.0.0`

而 `node_modules` 中那些带有软连接标志的文件夹就是你项目中的依赖包, 它们映射到 `node_modules/.pnpm`.

- 软连接: 相当于一个映射, 映射所指向的链接才是它们真正所在的位置.

若 `node_modules/.pnpm` 的包 A 的 `node_modules` 除了名为 A 的依赖(硬链接), 还有其它包 B 等, 那么这些包仍然是软连接, 链接到被摊平的目录: `node_modules/.pnpm` 的对应文件夹中(即: 包名和版本号对应的文件夹).

```js
  .pnpm
/         \
/           \
/             \
a@1.0.0		  b@1.0.0		  -> 第一层都是硬链接, 存储每个包	
/                \
node_modules  node_modules    -> 为了更好的分级, 从而有此文件夹
/        \          \
b@1.0.0===\软链接===》b@1.0.0   -> 存储包 b@1.0.0 的所在
           \
         a@1.0.0			  -> 存储包 a@1.0.0 的所在
```
- 即: `.pnpm` 目录下的第一层文件夹都是硬链接, 它们是真正占用磁盘空间的, 存储每个包的.

- `第一层文件/node_modules/和第一层文件夹相同名字的包`  是存储此包所在的真正目录.
  比如:  `a@1.0.0/node_modules/a@1.0.0` 是真正存储 `a@1.0.0` 包所在的目录.

- 如果 `a@1.0.0` 还依赖其他包, 比如: `b@1.0.0`, 则会以**软连接**的形式存储在 `a@1.0.0/node_modules/` 中, 其文件名字则是依赖的包名: `b@1.0.0`,

  而此软链接指向 `.pnpm` 下的`相同包名@相同版本号` 的文件夹(第一层级), 此文件夹就是存储被软链接, 所链接的包, 真正的存储位置.

- 如果除了 `.pnpm` 的 `第一层文件夹/node_modules/和第一层文件夹相同名字的包` 之外, 还有任何其他包, 

  那么这些包都属于软链接, 链接到 `.pnpm` 下 `第一层文件夹的相同包名@相同版本号`(第一层级)

  ​

# Reference

- [npm/yarn 和 pnpm 对比](https://juejin.cn/post/7098260404735836191) 