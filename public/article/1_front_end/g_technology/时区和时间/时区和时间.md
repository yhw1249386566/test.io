# 原生js实现格式化时区

格式化一个零时区 [时间 A] 到指定 [时区 A]

1. 得到用户当前所在位置与零时区的偏移量
   
   [Date.prototype.getTimezoneOffset() - JavaScript | MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getTimezoneOffset) 

2. 待转换时间 + 偏移量 = 格式化时区后的时间
   
   注意：getTimezoneOffset() 得到的值，它的单位是 **分钟**。
   
   ```ts
   const now = '2022-12-12 12:00:00' // 零时区
   const offset = new Date().getTimezoneOffset() // 偏移量；如果在中国 -> -480, 为什么是负数，看下面的解释。
   const msOffset = offset * 60 * 1000
   
   if( msOffset < 0 ) {
     const timezoneTime = new Date('2022-12-12 12:00:00').getTime() + Math.abs(msOffset);
     console.log("__xiao", timezoneTime); // 2022-12-12 20:00:00
   }
   
   if( msOffset >= 0 ) {
     const timezoneTime = new Date('2022-12-12 12:00:00').getTime() - Math.abs(msOffset)
     console.log("__da", timezoneTime); // 什么都不会输出
   }
   ```

# 时区

## moment-timezone 实现任意格式时间（包时区）

```ts
import moment from 'moment-timezone';

// 得到当前时区和零时区的偏移量，如：-8, +8
const timezoneOffset = (moment.tz.zone(moment.tz.guess())?.utcOffset(Date.now()) ?? 0) / 60;

// 在 moment-timzone 中比零时区快 N 小时，用减号（-）表示；慢 N 小时，用加号（+）表示
// 如：中国比零时区快8小时，在 moment-timzone 中使用 -8 表示；
// 但由于是快8小时，按照习惯，我们这里用 +8 表示 => 00:00:00 零时区 相当于 08:00:00 中国时区
const timezone =
  timezoneOffset > 0 ? `-${Math.abs(timezoneOffset)}` : `+${Math.abs(timezoneOffset)}`;

const placementDate = route.params?.placementDate;

const showPlacementDate = `${moment(placementDate).format('DD')} ${moment(placementDate).format(
  'MMM',
)} ${moment(placementDate).format('YYYY')} ${moment(placementDate).format(
  'HH:MM:SS',
)} GMT${timezone}`;
```

## js+moment-timezone 倒计时

```ts
// @return HH:mm:ss 
// 这实现的是: [小时]无限累加 => 100:50:00
function getCountDown({ expireDate, currentDate }) {
    const expire = moment(expireDate).format('YYYY-MM-DD hh:mm:ss')
    const now = moment(currentDate).format('YYYY-MM-DD HH:mm:ss')
    const sec = (new Date(expire).getTime() - new Date(now).getTime()) / 1000:
    let remainingDays = Math.floor(sec / (60 * 60 * 24))
    let remainingHours = Math.floor(sec / (60 * 60)) - remainingDays * 24
    let remainingMinutes = Math.floor(sec / 60) - remainingDays * 24 * 60 - remainingHours * 60
    let remainingSeconds =
        Math.floor(sec) -
        remainingDays * 24 * 60 * 60 -
        remainingHours * 60 * 60 -
        remainingMinutes * 60

    remainingDays = remainingDays ? '0' + remainingDays : remainingDays
    remainingHours =
        remainingHours + +remainingDays * 24 < 10 ? '0' + remainingHours : remainingHours
    remainingMinutes = remainingMinutes < 10 ? '0' + remainingMinutes : remainingMinutes
    remainingSeconds = remainingSeconds < 10 ? '0' + remainingSeconds : remainingSeconds

    return `${remainingHours + remainingDays * 24}:${remainingMinutes}:${remainingSeconds}`
}
```

## moment 格式化时区

```ts
const convertUtcTimeToLocal = (time, targetFormat = '') => {
    const utcOffset = moment().utcOffset()
    const formatTime = moment
        .utc(time)
        .utcOffset(utcOffset)
        .format(targetFormat || 'YYYY-MM-DD HH:mm:ss')
    return formatTime
}
```

# Reference

- [日期的格式，如：YYYY-MM-DD](https://help.highbond.com/helpdocs/analytics/141/user-guide/zh-cn/Content/defining_importing_data/data_definition_wizard/formats_of_date_and_time_source_data.htm) 
- [日期格式的可选参数，如：M, MM, MMM 都是什么](https://blog.csdn.net/sinat_17775997/article/details/52130948)
- [moment-timezone](https://momentjs.com/timezone/docs/) 
- [moment.js](http://momentjs.cn/docs/) 