# 概念

当一个数据太过于庞大时（如成千上万，甚至上百万），我们需要一个良好的办法来显示这些数据，我们不可能将这个庞大的数据一股脑的渲染到页面，

且不说因为数据过多导致的死机的问题，就算数据成功渲染，但是这么多的数据用户如何查看呢？所以我们需要想一个办法去解决这个问题。

其中有许多解决办法，如：分页渲染（参见：[原生实现分页渲染](https://gitee.com/yomua/privatenotes/blob/master/Difficult%20Concept/%E5%B0%81%E8%A3%85%E7%9A%84Code/JS/%E5%88%86%E9%A1%B5%E6%B8%B2%E6%9F%93/%E5%8E%9F%E7%94%9F%E5%AE%9E%E7%8E%B0%E5%88%86%E9%A1%B5%E6%B8%B2%E6%9F%93.md)）、下拉加载（或两者一起使用）。

这里，我们说的便是下拉加载这个解决办法，大概思路为：

1. 监听元素（或当前文档）的滚动事件（onscroll 或 scroll）

2. 获取元素的滚动条的位置（scrollTop）

3. 获取元素（可能是当前文档）的范围高度（clientHeight）

   *指的是 css:height 属性值的大小。*

4. 获取元素（可能是当前文档）的内容高度（scrollHeight ）

   *指的是从当前元素的滚动条位置 0 -> 最底下的滚动条位置 的高度，即：整个滚动区域有多高*

5. 当元素滚动条的位置 + 范围高度 === 元素内容高度，就说明当前滚动条已经滚到底了，

   就使得滚动事件处理器中做一些副作用（请求数据将元素渲染到页面，或重新渲染页面，或做任何事情）

   PS：只要元素有滚动，就会触发滚动事件，不过我们可以在里面做一些判断，使得滚动条只有滚动到底的时候才做一些事

   - 当前元素范围高度（height 属性值） + 滚动条位置 === 总共内容高度，就可以得出当前滚动位置已经滑动底了！

TIP：同理的还有：**scrollWidth** 、**clientWidth** 等，也就是说你还能计算横向的滚动条是否到底。



# 有注释

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>下拉刷新</title>
</head>
<style>
    ol {
        height: 200px;
        overflow: auto;
    }
</style>

<body>
    <div class="data">
        <ol class="ol">
            <li class="li"></li>
            <li>1</li>
            <li>1</li>
            <li>1</li>
            <li>1</li>
            <li>1</li>
            <li>1</li>
            <li>1</li>
            <li>1</li>
            <li>1</li>
            <li>1</li>
            <li>1</li>
            <li>1</li>
            <li>1</li>
            <li>1</li>
        </ol>
    </div>
</body>
<script>
  // scrollTop: 你已滚动具体 到 当前可视区域的内容顶部的高度
  // clientHeight：可视区域高度
  // scrollHeight：整个元素高度，包括不可见的区域
    let data = [
        { id:  1 }, { id:  2 }, { id:  3 }, { id:  4 }, { id:  5 },
        { id:  6 }, { id:  7 }, { id:  8 }, { id:  9 }, { id: 10 },
        { id: 11 }, { id: 12 }, { id: 13 }, { id: 14 }, { id: 15 },
        { id: 16 }, { id: 17 }, { id: 18 }, { id: 19 }, { id: 20 },
        { id: 21 }, { id: 22 }, { id: 23 }, { id: 24 }, { id: 25 },
        { id: 26 }, { id: 27 }, { id: 28 }, { id: 29 }, { id: 30 },
        { id: 31 }, { id: 32 }, { id: 33 }, { id: 34 }, { id: 35 },
        { id: 36 }, { id: 37 }, { id: 38 }, { id: 39 }, { id: 40 },
        { id: 41 }, { id: 42 }, { id: 43 }, { id: 44 }, { id: 45 },
        { id: 46 }, { id: 47 }, { id: 48 }, { id: 49 }, { id: 50 },
        { id: 51 }, { id: 52 }, { id: 53 }, { id: 54 }, { id: 55 },
        { id: 56 }, { id: 57 }, { id: 58 }, { id: 59 }, { id: 60 },
        { id: 61 }, { id: 62 }, { id: 63 }, { id: 64 }, { id: 65 },
        { id: 66 }, { id: 67 }, { id: 68 }, { id: 69 }, { id: 70 },
        { id: 71 }, { id: 72 }, { id: 73 }, { id: 74 }, { id: 75 },
        { id: 76 }, { id: 77 }, { id: 78 }, { id: 79 }, { id: 80 },
        { id: 81 }, { id: 82 }, { id: 83 }, { id: 84 }, { id: 85 },
        { id: 86 }, { id: 87 }, { id: 88 }, { id: 89 }, { id: 90 },
        { id: 91 }, { id: 92 }, { id: 93 }, { id: 94 }, { id: 95 },
        { id: 96 }, { id: 97 }, { id: 98 }, { id: 99 }, { id: 100 },
    ]
    const dataEle = document.querySelector('.data')
    const ul = document.querySelector('.ul')
    const ol = document.querySelector('.ol')
    // 获取滚动条当前的位置
    const getScrollTop = () => {
        var scrollTop = 0;
        ol && ol.scrollTop
            ? scrollTop = ol.scrollTop
            : scrollTop = document.body.scrollTop;
        return scrollTop;
    }
    // 获取当前 ol 范围的高度  
    const getClientHeight = () => {
        var clientHeight = 0;
        ol.clientHeight
            ? clientHeight = Math.min(document.body.clientHeight, ol.clientHeight)
            : clientHeight = Math.max(document.body.clientHeight, ol.clientHeight)
        return clientHeight;
    }
    // 获取 ol 元素内容高度（包括超出隐藏的那部分）
    const getScrollHeight = () => Math.max(ol.scrollHeight);
    // 滚动事件触发
    const olOnscroll = () =>
        // 当前滚动条位置 + 范围高 = 总高就碰到了元素底部。
        (getScrollTop() + getClientHeight()) === getScrollHeight()
            ? ol.innerHTML = data.map((item) => `<li>${item.id}</li>`)
            : null

    ol.addEventListener('scroll', olOnscroll)
</script>

</html>
```
