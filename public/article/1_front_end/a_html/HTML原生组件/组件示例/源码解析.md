# 总体概览

tabs是一个数组,存放了tabsSlot元素中的light DOM的名称
panels是一个数组, 存放了pancelsSlot元素中的light DOM的名称

1. 首先将用户在fancy-tabs写的元素 放入对应的fancy-tabs的shadow DOM的slot元素中

2. 获取slot元素中存放的light DOM的名称,将所有名称依次放入一个数组中.

   最后得到两个数组

   1. tabs: 存放每个button元素
   2. panels:存放每个section元素

3. 为panels中的每个section设置role和tabindex属性

   并为tabsSlot(存放button的slot父元素)注册两个事件监听器.

   - click

     事件处理程序为:绑定了fancy-tabs作为this的_boundOnTitleClick

   - keydown

     事件处理程序为:绑定了fancy-tabs作为this的_boundOnKeyDown

4. 获取第一次程序运行时tabs数组中具有selected的button元素索引

   并为每个tabs数组中的每个button设置role:tab.

   再将获取到的具有selected属性的button的索引值作为参数传递给 fancy-tabs对象的selected伪属性.

5. 在selected伪属性中,会调用_selectTab()函数,并传入具有selected属性的button的索引值作为参数, _selectTab()接受的参数名为:idx

   _selectTab()函数的作用是: 遍历tabs数组,找到在tabs数组中和当前idx索引值相等的索引值.

   最后为tabs数组中,元素的索引值不等于idx的button元素添加属性:

   - tabindex:-1
   - aria-selected: false
   - aria-hidden: true

   对于元素的索引值等于idx的button,为它设置html属性:

   - tabindex:0
   - aria-selected: true
   - aria-hidden: false

   最后由于预设了CSS属性,*即[aria-hidden="true"]{display: none;}*所以非对应的button的section元素都会被隐藏.

6. 最后用户在单击button时,由于事件冒泡机制,会触发当前点击元素的click事件处理程序 -> 父元素(#tabsSlot)的click事件处理程序 -> body 

   -> html ***(参见:<Event.md>)***

   由于当前点击元素(我们没设置)不存在click事件处理程序,所以会执行#tabsSlot父元素的事件处理程序: _onTitleClick(e)

   再该事件处理函数中,会判断是否为button元素触发的click事件从而由于事件冒泡机制导致#tabsSlot元素的事件处理函数触发(_onTitleClick)

   如果是的话,则找到用户当前点击的button在tabs数组中的索引位置是第几个,即查找用户点击的button的位置在哪里.

   并将该索引值传递给selected伪属性,然后重复第5个步骤,这样当用户点击哪个button时,对应的面板(section元素)就会显示,其他面板都会消失.

# 两个事件监听器的作用

## _onTitleClick(e)

点击tabsSlot元素中的button时,会触发click事件,而click事件会执行该函数(注意该回调函数是所有button元素父元素,它是由于事件冒泡机制被触发的)

详见 总体概览 第6点

## _onKeyDown(e)

按下键等于按左键,按上键等于按右键.

### 按下键等于按左键

先阻止按下或左键这一事件的默认行为发生.

然后获取当前被选中的button的在tabs数组(存放每一个button的引用)中的索引值,并**减**1,

如果 当前被选中的button的索引值 - 1 < 0,则使最后一个button被选中,否则照常选择当前被选中的button左边的button.

且每一次按 下或左键都如同用户触发了单击事件,所以每次使用下或左键选中button都如同单击一次button.

所以接着又会触发_onTitleClick(e)事件处理函数

### 按上键等于按右键.

先阻止按上或右键这一事件的默认行为发生.

然后获取当前被选中的button的在tabs数组(存放每一个button的引用)中的索引值,并**加**1,获取完索引值之后,每一次按 上或右键,都会触发以下操作:

- 当前button的索引值为0(第一个按钮),则用户按下右/上键时,就选中0+1%3=1,即第2个按钮(数组下标从0开始;0,1)
- 当前button的索引值为1(第二个按钮),则用户按下右/上键时,就选中1+1%3=2,即第3个按钮(数组下标从0开始; 0,1,2)
- 当前button的索引值为2(第三个按钮),则用户按下右/上键时,就选中2+1%3=0,即第1个按钮(数组下标从0开始; 0)

且每一次按上或右键都如同用户触发了单击事件,所以每次使用上或右键选中button都如同单击一次button.

所以接着又会触发_onTitleClick(e)事件处理函数

