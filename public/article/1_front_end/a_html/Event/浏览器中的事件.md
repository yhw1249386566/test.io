# [事件参考](https://developer.mozilla.org/zh-CN/docs/Web/Events)

# 拖拽相关事件

## [DragEvent.dataTransfer](https://developer.mozilla.org/zh-CN/docs/Web/API/DragEvent/dataTransfer) 

**`DataEvent.dataTransfer`** 属性保存着拖拽操作中的数据（作为一个 DataTransfer 对象）

## 可拖拽元素的事件

1. [dragstart](https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement/dragstart_event) 可拖拽元素被开始拖拽时触发一次。
   对于要拖拽的元素，我们需要让此元素成为可拖拽的，需要设置属性 **draggable** =>

   ```html
    <div draggable="true">可拖拽</div>
   ```

   如果不设置，拖拽是没效果的，不会触发 **dragstart** 事件。

## 可拖拽元素的容器上的事件

1. [dragenter](https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement/dragenter_event) 在容器上触发。即：可拖拽元素被拖拽至有效的容器时，触发一次。
2. [dragover](https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement/dragover_event) 在容器上触发。即：可拖拽元素被拖拽至有效的容器时，每隔几百毫秒触发此事件。
3. [dragleave](https://www.runoob.com/try/try.php?filename=tryjsref_ondragenter) 在容器上触发。即：可拖拽元素离开有效的容器时，触发一次。
4. [drop](https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement/drop_event) 在容器上触发。即：可拖拽元素被放置在有效容器上触发一次，即：松手后触发。
5. [dragend](https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement/dragend_event) 在容器上触发。即：拖拽事件结束（被防止在有效容器或取消拖拽）后，最后触发的事件。

```html
<div 
     ondragenter="dragEnter(event)" 
     ondragover="dragOver(event)" 
     ondragleave="dragLeave(event)"
     ondrop="drop(event)"
     ondragend="ondragEnd(event)">
    <div draggable="true" ondragstart="dragStart(event)">
        可拖拽
    </div>
</div>
```

- dragenter 和 dragover 它们二者都是在可拖拽元素被拖拽至有效的容器时触发，区别是前者每次拖拽到有效容器时只触发一次，后者则是可拖拽元素在有效容器内时每隔几百毫秒都会触发。

  **dragenter 使用场景：**用于在拖拽元素进入可拖放区域时，对该区域进行一些预处理操作或样式改变。

  **dragover 使用场景：**用于在拖拽元素在可拖放区域内移动时，对该区域进行一些样式改变或其他操作，以提供拖拽反馈或实现自定义的拖放效果。

- drop 和 dragend 它们二者也有共同之处，即：可拖拽元素被放置在有效容器后触发，但是  dragend 在取消拖拽时也会触发。
  即：当把可拖拽元素拖拽到非有效容器，然后取消拖拽，会触发 dragend，但是不会触发 drop，drop 一定是可拖拽元素被放置在有效容器才会触发。
  **drop 使用场景：**用于处理拖拽元素在可拖放区域被放置后的处理。在 `drop` 事件中，通常会进行一些数据交换、元素移动或其他操作。
  **dragend 使用场景：**用于在拖拽操作结束后进行一些清理工作或处理。

## 拖拽事件执行顺序

如果不考虑 `dragleave` 事件，则执行顺序为：

1. dragstart
2. dragenter
3. dragover
4. drop
5. dragend

## 示例

```html
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
</head>

<style>
  .droptarget {
    float: left;
    width: 100px;
    height: 35px;
    margin: 15px;
    margin-right: 100px;
    padding: 10px;
    border: 1px solid #aaaaaa;
  }
</style>

<body>
  <div class="droptarget" ondrop="drop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)"
    ondragover="dragOver(event)" ondragend="dragEnd(event)">
    <p ondragstart="dragStart(event)" draggable="true" id="dragtarget">
      拖动我!
    </p>
  </div>

  <div class="droptarget" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)" ondrop="drop(event)"
    ondragover="dragOver(event)" ondragend="dragEnd(event)"></div>
  <p id="demo"></p>

  <script>
    function dragStart(event) {
      console.log('dragStart: 开始拖拽', event)
      event.dataTransfer.setData("dragElementId", event.target.id);
    }

    function dragLeave(event) {
      console.log("dragleave: 可拖拽元素离开有效的容器时，触发一次。")
      document.getElementById("demo").innerHTML = "离开放置区域";
      if (event.target.className == "droptarget") {
        event.target.style.border = "";
      }
    }

    function dragEnter(event) {
      console.log("dragenter: 可拖拽元素被拖拽至有效的容器时，触发一次。")
      document.getElementById("demo").innerHTML = "进入放置区域";
      if (event.target.className == "droptarget") {
        event.target.style.border = "3px dotted red";
      }
    }

    function dragOver(event) {
      console.log("dragover: 可拖拽元素被拖拽至有效的容器时，每隔几百毫秒触发此事件")
      event.preventDefault();
    }

    function drop(event) {
      console.log("drop: 可拖拽元素被放置在有效容器上触发，即：松手后触发", event)
      event.preventDefault();
      var data = event.dataTransfer.getData("dragElementId");
      event?.target?.appendChild(document?.getElementById(data));
    }

    function dragEnd(event) {
      console.log("dragend: 拖拽结束或取消")
    }

  </script>
</body>

</html>
```



## Reference

- [菜鸟教程 - 拖拽事件](https://www.runoob.com/jsref/event-ondragenter.html) 

 

