{"version":3,"sources":["webpack:///./src/index.less","webpack:///./src/layouts/header/index.less","webpack:///./src/layouts/header/index.tsx","webpack:///./src/index.tsx","webpack:///./src/store/context.ts","webpack:///./src/store/provider.tsx","webpack:///./src/store/store.ts","webpack:///./src/store/inner/createSlice.ts","webpack:///./src/utils/storage.ts"],"names":["module","exports","Header","props","theme","onToggleTheme","useState","menuIcon","setMenuIcon","history","useHistory","location","useLocation","useEffect","EventEmitter","EVENT_NAME","icon","className","classnames","Style","pathname","includes","onClick","push","RouteLink","style","faSun","faMoon","activeTheme","storage","key","LOCAL_STORAGE_NAME","value","memo","library","fas","faFacebookSquare","faYoutubeSquare","faLinkedin","faTwitterSquare","Index","setTheme","handleChangeTheme","useCallback","html","document","querySelector","setAttribute","localTheme","store","children","StoreContext","createContext","StoreProvider","Store","constructor","reducerMap","stateMap","this","singleInstance","instance","saveReducer","type","reducer","getReducer","saveState","state","getState","reducers","states","getProxyActions","scopeName","proxyReducers","fnName","payload","createSlice","config","name","initialState","Error","actions","saveLocalStorage","data","localStorage","setItem","log","saveBatchLocalStorage","isHaveKey","forEach","item","getLocalStorage","options","returnType","converter","CONVERT_TYPE_MAP","getItem","clearLocalStorage","removeItem","clearAllLocalStorage","clear","saveSessionStorage","sessionStorage","getSessionStorage"],"mappings":"gFACAA,EAAOC,QAAU,CAAC,OAAS,iBAAiB,UAAY,oBAAoB,iCAAmC,2CAA2C,+BAAiC,yCAAyC,qBAAuB,+B,oBCA3PD,EAAOC,QAAU,CAAC,eAAe,uBAAuB,cAAc,sBAAsB,OAAS,iBAAiB,SAAW,mBAAmB,UAAY,oBAAoB,KAAO,eAAe,WAAa,qBAAqB,UAAY,oBAAoB,aAAe,uBAAuB,KAAO,eAAe,iCAAmC,2CAA2C,+BAAiC,yCAAyC,qBAAuB,+B,0QCkBjfC,EAAUC,IACZ,MAAwDA,EAAhDC,aAAR,MAAgB,QAAhB,IAAwDD,EAA/BE,qBAAzB,MAAyC,IAAM,KAA/C,EAEA,GAAgCC,cAA2B,QAA3D,eAAOC,EAAP,KAAiBC,EAAjB,KAEMC,GAAUC,UACVC,GAAWC,UAYjB,OAVAC,gBAAU,KACNC,OAAgBC,uBAA8BC,IAC1CR,EAAYQ,EAAZ,IAGG,KACHF,QAAiBC,sBAAjB,IAEL,IAGC,uBAAKE,WAAWC,OAAWC,WAAcA,IAAM,UAAD,OAAWf,MACrD,gBAAC,KAAD,CAAWa,UAAWE,gBAClB,gBAAC,KAAD,CAAWF,UAAWE,UAClB,gBAAC,IAAD,CACIH,KAAMT,EACNU,WAAWC,OAAWC,aAAgB,CAClC,CAACA,mBACIR,EAASS,SAASC,SAAS,sBAEpCC,QAAS,KACLd,EAAyB,SAAbD,EAAsB,QAAU,QAC5CO,SAAkBC,4BAAlB,IAIR,uBACIE,UAAWE,SACXG,QAAS,KACLb,EAAQc,KAAR,WAAiBC,aACjBhB,EAAY,OAAZ,KAKZ,uBACIS,UAAWE,cACXG,QAAS,KACLR,SAAkBC,uBAAlB,GAGJ,gBAAC,KAAD,OAGJ,gBAAC,KAAD,CAAWU,MAAON,WACd,gBAAC,IAAD,CACIF,UAAWE,cACXH,KAAgB,UAAVZ,EAAoBsB,MAAQC,MAClCL,QAAS,KACL,IAAMM,EACQ,UAAVxB,EAAoB,OAAS,QAEjCyB,qBAAyB,CACrBC,IAAKC,gBACLC,MAAOJ,IAIXvB,EAAcuB,EAAd,MAhDxB,EAyDJ,GAAeK,UAAK/B,G,sBCxEpBgC,SAAYC,MAAKC,MAAkBC,MAAiBC,MAAYC,OAchE,IAAMC,EAASrC,IACX,OAA0BG,cAAgB,SAA1C,eAAOF,EAAP,KAAcqC,EAAd,KAEMC,GAAoBC,kBAAavC,IACnCqC,EAASrC,EAAT,GACD,IAuBH,OArBAS,gBAAU,KACN,IAAM+B,EAAOC,SAASC,cAAc,QAE/BF,GAILA,EAAKG,aAAahB,gBAA+B3B,EAAjD,GACD,CAACA,KAGJS,gBAAU,KACN,IAAMmC,EAAanB,oBACfE,iBAGAiB,GACAP,EAASO,EACZ,GACF,IAGC,gBAAC,KAAD,CAAeC,MAAO,MAClB,gBAAC,IAAD,CAAe7C,MAAOA,GAClB,gBAAC,IAAD,CAAQa,UAAWQ,YACf,gBAAC,EAAD,CAAQrB,MAAOA,EAAOC,cAAeqC,IAErC,gBAAC,YAAD,CAAgBzB,UAAWQ,eACvB,gBAAC,KAAD,MACCtB,EAAM+C,YAR3B,EAkBJ,G,6GChFMC,GAAeC,mBAAc,CAAEH,MAAO,OAE5C,ICGe,SAASI,EAAclD,GAClC,IAAQ8C,EAAoB9C,EAApB8C,MAAOC,EAAa/C,EAAb+C,SAEf,OACI,gBAAC,WAAD,CACIlB,MAAO,CACHiB,UAEHC,EAGZ,CCdD,MAAMI,EAKFC,cAAc,KAHNC,gBAGM,OAFNC,cAEM,EACVC,KAAKF,WAAa,CAAC,EACnBE,KAAKD,SAAW,CAAC,CACpB,CAEUE,4BAKP,OAJKD,KAAKE,WACNF,KAAKE,SAAW,IAAIN,GAGjBI,KAAKE,QACf,CAGDC,YAAYC,EAAsBC,GAC9BL,KAAKF,WAAWM,GAAQC,CAC3B,CAEDC,WAAWF,GACP,OAAOJ,KAAKF,WAAWM,EAC1B,CAEDG,UAAUH,EAAcI,GACpBR,KAAKD,SAASK,GAAQI,CACzB,CAEDC,SAASL,GACL,OAAOJ,KAAKD,SAASK,EACxB,CAEGM,eACA,OAAOV,KAAKF,UACf,CAEGa,aACA,OAAOX,KAAKD,QACf,EAzCCH,EACKM,c,EA2CX,MAAeN,EAAf,eC7BA,SAASgB,EACLC,EACAH,GAGA,IAAMI,EAA0D,CAAC,EAFnE,WAIaC,GACP,IAAMX,EAAO,GAAH,OAAMS,EAAN,YAAmBE,GAE7BxB,cAAkBa,EAAMM,EAASK,IAEjCD,EAAcC,GAAU,SAAUC,GAC9B,MAAO,CACHZ,OACAY,UAEP,CAdP,EAIE,IAAK,IAAMD,KAAUL,EAAU,EAApBK,GAaX,OAAOD,CACV,CAEc,SAASG,EAAYC,GAChC,IAAQC,EAAiCD,EAAjCC,KAAMC,EAA2BF,EAA3BE,aAAcV,EAAaQ,EAAbR,SAE5B,GAAInB,WAAe4B,GACf,MAAM,IAAIE,MAAJ,uBAAgBF,EAAhB,8BAGV5B,YAAgB4B,EAAMC,GAEtB,IAAME,EAAUV,EAAgBO,EAAMT,GAQtC,MAAO,CACHY,UACAjB,QAAS,CAAC,EAEjB,C,+DCxDKkB,EACFC,IAGA,IAAQpD,EAAeoD,EAAfpD,IAAKE,EAAUkD,EAAVlD,MAEb,OAAKF,GAKLqD,aAAaC,QAAQtD,EAAKE,IAEnB,IANHqD,UAAU,0CAA4BvD,IAC/B,EAKX,EAGEwD,EAAyBJ,IAC3B,IAAIK,GAAY,EAYhB,OAVAL,EAAKM,SAASC,IACV,IAAKA,EAAK3D,IAKN,OAJAyD,GAAY,OACZF,UACI,mHAGP,MAGAE,IAELL,EAAKM,SAASC,IACV,aAAuBA,QAAvB,IAAuBA,IAAQ,CAAC,EAAxB3D,EAAR,EAAQA,IAAKE,EAAb,EAAaA,MAEbmD,aAAaC,QAAQtD,EAAKE,EAA1B,KAGG,EAAP,EAGE0D,EAAkB,CAIpB5D,EACA6D,KACqC,MACrC,IAAK7D,EAED,OADAuD,UAAU,2CACH,GAGX,aAAkCM,QAAlC,IAAkCA,IAAW,CAAC,EAA9C,IAAQC,kBAAR,MAAqB,SAArB,EAEMC,EAAYC,KAAiBF,GAEnC,OAAOC,EAAS,UAACV,aAAaY,QAAQjE,UAAtB,QAA8B,GAA9C,EAMEkE,EAAqBlE,GAClBA,GAKLqD,aAAac,WAAWnE,IAEjB,IANHuD,UAAU,8CACH,GAQTa,EAAuB,KACzBf,aAAagB,SACN,GAGLC,EACFlB,IAGA,IAAQpD,EAAeoD,EAAfpD,IAAKE,EAAUkD,EAAVlD,MAERF,EAKLuE,eAAejB,QAAQtD,EAAKE,GAJxBqD,UAAU,6CAId,EAGEiB,EAAqBxE,IAAgB,MACvC,OAAKA,EAKL,UAAOuE,eAAeN,QAAQjE,UAA9B,QAAsC,IAJlCuD,UAAU,6CACH,GAGX,EAGJ,QAEIJ,mBACAK,wBACAI,kBACAM,oBACAE,uBAGAE,qBACAE,oB","file":"index.aa560ac7.async.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"layout\":\"layout___1uzIr\",\"container\":\"container___3XCPZ\",\"absoluteHorizontalVerticalCenter\":\"absoluteHorizontalVerticalCenter___21_uB\",\"marginHorizontalVerticalCenter\":\"marginHorizontalVerticalCenter___3QJyU\",\"textOverflowEllipsis\":\"textOverflowEllipsis___1wr59\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header-light\":\"header-light___3cGmx\",\"header-dark\":\"header-dark___pcRuq\",\"header\":\"header___2O2lm\",\"menuIcon\":\"menuIcon___3n4mO\",\"themeIcon\":\"themeIcon___q2Qkx\",\"logo\":\"logo___11RZm\",\"headerInfo\":\"headerInfo___25wHO\",\"searchBox\":\"searchBox___3hXJ9\",\"hideMenuIcon\":\"hideMenuIcon___f7ivs\",\"left\":\"left___2g1gv\",\"absoluteHorizontalVerticalCenter\":\"absoluteHorizontalVerticalCenter___2C_vn\",\"marginHorizontalVerticalCenter\":\"marginHorizontalVerticalCenter___scs3c\",\"textOverflowEllipsis\":\"textOverflowEllipsis___PsGMq\"};","import { memo, useEffect, useState } from 'react'\nimport { useHistory } from 'umi'\nimport { useLocation } from 'react-router-dom'\nimport classnames from '@yomua/y-classnames'\nimport EventEmitter from '@yomua/y-eventemitter'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faSun, faMoon } from '@fortawesome/free-solid-svg-icons'\n\nimport storage from '@/utils/storage'\nimport { Direction, Search } from '@/component'\nimport { RouteLink, EVENT_NAME, LOCAL_STORAGE_NAME } from '@/utils/constant'\n\nimport Style from './index.less'\n\ninterface HeaderProps {\n    theme?: Theme\n    onToggleTheme?: (theme: Theme) => void\n}\n\nconst Header = (props: HeaderProps) => {\n    const { theme = 'light', onToggleTheme = () => null } = props\n\n    const [menuIcon, setMenuIcon] = useState<'bars' | 'xmark'>('bars')\n\n    const history = useHistory()\n    const location = useLocation() // 不能替换为 location, 要用 useLocation 来监听 url change, 从而使得组件重新渲染\n\n    useEffect(() => {\n        EventEmitter.on(EVENT_NAME.HEADER_MENU_ICON, (icon) => {\n            setMenuIcon(icon)\n        })\n\n        return () => {\n            EventEmitter.off(EVENT_NAME.HEADER_MENU_ICON)\n        }\n    }, [])\n\n    return (\n        <div className={classnames(Style.header, Style[`header-${theme}`])}>\n            <Direction className={Style.headerInfo}>\n                <Direction className={Style.left}>\n                    <FontAwesomeIcon\n                        icon={menuIcon}\n                        className={classnames(Style.menuIcon, {\n                            [Style.hideMenuIcon]:\n                                !location.pathname.includes('/feature/article'),\n                        })}\n                        onClick={() => {\n                            setMenuIcon(menuIcon === 'bars' ? 'xmark' : 'bars')\n                            EventEmitter.emit(EVENT_NAME.OPEN_ARTICLE_DIRECTORY)\n                        }}\n                    />\n\n                    <div\n                        className={Style.logo}\n                        onClick={() => {\n                            history.push(`/${RouteLink.Index}`)\n                            setMenuIcon('bars')\n                        }}\n                    ></div>\n                </Direction>\n\n                <div\n                    className={Style.searchBox}\n                    onClick={() => {\n                        EventEmitter.emit(EVENT_NAME.SHOW_SEARCH_PANEL)\n                    }}\n                >\n                    <Search />\n                </div>\n\n                <Direction style={Style.right}>\n                    <FontAwesomeIcon\n                        className={Style.themeIcon}\n                        icon={theme === 'light' ? faSun : faMoon}\n                        onClick={() => {\n                            const activeTheme =\n                                theme === 'light' ? 'dark' : 'light'\n\n                            storage.saveLocalStorage({\n                                key: LOCAL_STORAGE_NAME.DATA_THEME,\n                                value: activeTheme,\n                            })\n\n                            // 将在 @/index 设置主题\n                            onToggleTheme(activeTheme)\n                        }}\n                    />\n                </Direction>\n            </Direction>\n        </div>\n    )\n}\n\nexport default memo(Header)\n","import React, { useCallback, useEffect, useState } from 'react'\nimport { Layout } from 'antd'\nimport { fas } from '@fortawesome/free-solid-svg-icons'\nimport { library } from '@fortawesome/fontawesome-svg-core'\nimport {\n    faLinkedin,\n    faTwitterSquare,\n    faYoutubeSquare,\n    faFacebookSquare,\n} from '@fortawesome/free-brands-svg-icons'\n// import IndexedDB from '@yomua/y-indexeddb'\n\nimport style from './index.less'\n// import Footer from './layouts/footer'\nimport { Sidebar } from './component'\nimport Header from './layouts/header'\nimport storage from './utils/storage'\nimport { ThemeProvider } from './contexts'\nimport { LOCAL_STORAGE_NAME } from './utils/constant'\nimport { StoreProvider } from './store'\n\n// 添加 fontawesome 免费版: https://fontawesome.com/search?q=menu&o=r&m=free\nlibrary.add(fas, faFacebookSquare, faYoutubeSquare, faLinkedin, faTwitterSquare)\n\n// 初始化 IndexedDB\n// 注意: 目前不需要用它\n// IndexedDB.singleInstance.open({\n//     dbVersion: 1,\n//     dbName: 'yomuaDB',\n//     dbStoreName: 'yomua',\n//     specifyKey: 'filepath',\n// })\n\n// 此文件匹配路由 '/', 所以可以认为此文件类似入口文件;\n// 为什么说类似? 因为 umi 已经配置了入口文件(使用者无感知), src/.umi/umi.ts,\n// => Ref: /umi_webpack_dev.js 或 umi_webpack_prod.js - entry 字段\nconst Index = (props: { children: React.ReactNode }) => {\n    const [theme, setTheme] = useState<Theme>('light')\n\n    const handleChangeTheme = useCallback((theme: Theme) => {\n        setTheme(theme)\n    }, [])\n\n    useEffect(() => {\n        const html = document.querySelector('html')\n\n        if (!html) {\n            return\n        }\n\n        html.setAttribute(LOCAL_STORAGE_NAME.DATA_THEME, theme)\n    }, [theme])\n\n    // 恢复用户上一次选择的主题\n    useEffect(() => {\n        const localTheme = storage.getLocalStorage<'string', Theme>(\n            LOCAL_STORAGE_NAME.DATA_THEME,\n        )\n\n        if (localTheme) {\n            setTheme(localTheme)\n        }\n    }, [])\n\n    return (\n        <StoreProvider store={null}>\n            <ThemeProvider theme={theme}>\n                <Layout className={style.layout}>\n                    <Header theme={theme} onToggleTheme={handleChangeTheme} />\n\n                    <Layout.Content className={style.container}>\n                        <Sidebar />\n                        {props.children}\n                    </Layout.Content>\n\n                    {/* <Footer /> */}\n                </Layout>\n            </ThemeProvider>\n        </StoreProvider>\n    )\n}\n\nexport default Index\n","import { createContext } from 'react'\n\nconst StoreContext = createContext({ store: null })\n\nexport default StoreContext\n","import StoreContext from './context'\n\ntype StoreProviderProps = {\n    store: any\n    children: React.ReactNode\n}\n\nexport default function StoreProvider(props: StoreProviderProps) {\n    const { store, children } = props\n\n    return (\n        <StoreContext.Provider\n            value={{\n                store,\n            }}>\n            {children}\n        </StoreContext.Provider>\n    )\n}\n","/* eslint-disable */\nimport { Action, Reducer } from './index.d'\n\n// 全局存储\nclass Store {\n    static instance: Store\n    private reducerMap: Record<Action['type'], Function>\n    private stateMap: Record<Action['type'], any>\n\n    constructor() {\n        this.reducerMap = {}\n        this.stateMap = {}\n    }\n\n    static get singleInstance() {\n        if (!this.instance) {\n            this.instance = new Store()\n        }\n\n        return this.instance\n    }\n\n    // 暂存 reducer\n    saveReducer(type: Action['type'], reducer: Function) {\n        this.reducerMap[type] = reducer\n    }\n\n    getReducer(type: Action['type']) {\n        return this.reducerMap[type] as Reducer\n    }\n\n    saveState(type: string, state: any) {\n        this.stateMap[type] = state\n    }\n\n    getState(type: string) {\n        return this.stateMap[type]\n    }\n\n    get reducers() {\n        return this.reducerMap\n    }\n\n    get states() {\n        return this.stateMap\n    }\n}\n\nexport default Store.singleInstance\n","import store from '../store'\nimport { Action, Reducer } from '../index.d'\n\ntype SliceOptions = {\n    name: string\n    initialState: Record<string, any>\n    reducers: Record<string, Reducer>\n    // extraReducers?: object\n    // caseReducers?: object\n    // extraArgument?: object\n    // reducerPath?: string\n    // middleware?: object\n    // devTools?: object\n    // enhancers?: object\n    // preloadedState?: object\n}\n\n// 对用户定义的 reducers 进行代理\n// 当用户调用代理的 reducer 时，会经过这一层, 返回一个 Action, 再被用户使用 -> dispatch(Action)\nfunction getProxyActions(\n    scopeName: SliceOptions['name'],\n    reducers: SliceOptions['reducers'],\n) {\n    // 例如: { reducerName:()=>{} }\n    const proxyReducers: Record<string, (payload: any) => Action> = {}\n\n    for (const fnName in reducers) {\n        const type = `${scopeName}/${fnName}` as Action['type']\n\n        store.saveReducer(type, reducers[fnName])\n\n        proxyReducers[fnName] = function (payload: any) {\n            return {\n                type,\n                payload,\n            }\n        }\n    }\n\n    return proxyReducers\n}\n\nexport default function createSlice(config: SliceOptions) {\n    const { name, initialState, reducers } = config\n\n    if (store.getState(name)) {\n        throw new Error(`分片 ${name} 已经存在`)\n    }\n\n    store.saveState(name, initialState)\n\n    const actions = getProxyActions(name, reducers)\n\n    // const reducer = (state = initialState, action) => {\n    //     return reducers[action.type]\n    //         ? reducers[action.type](state, action)\n    //         : state\n    // }\n\n    return {\n        actions,\n        reducer: {},\n    }\n}\n","import log from '@yomua/y-tlog'\n\nimport { EnvValueType, JSValueType } from './utils.d'\nimport { CONVERT_TYPE_MAP, LOCAL_STORAGE_NAME } from './constant'\n\ntype StorageDataKey<KeyType> = { key: KeyType; value: string }\n\nconst saveLocalStorage = (\n    data: StorageDataKey<LOCAL_STORAGE_NAME>,\n    // config?,\n) => {\n    const { key, value } = data\n\n    if (!key) {\n        log.error('saveLocalStorage key 不存在', key)\n        return false\n    }\n\n    localStorage.setItem(key, value)\n\n    return true\n}\n\nconst saveBatchLocalStorage = (data: StorageDataKey<LOCAL_STORAGE_NAME>[]) => {\n    let isHaveKey = true\n\n    data.forEach((item) => {\n        if (!item.key) {\n            isHaveKey = false\n            log.error(\n                '批量保存数据到本地失败: saveBatchLocalStorage key 不存在',\n            )\n            return\n        }\n    })\n\n    if (!isHaveKey) return false\n\n    data.forEach((item) => {\n        const { key, value } = item ?? {}\n\n        localStorage.setItem(key, value)\n    })\n\n    return true\n}\n\nconst getLocalStorage = <\n    ReturnType extends JSValueType = 'string',\n    DataType = string,\n>(\n    key: LOCAL_STORAGE_NAME,\n    options?: { returnType?: ReturnType },\n): EnvValueType<ReturnType, DataType> => {\n    if (!key) {\n        log.error('getLocalStorage: key 不存在')\n        return '' as EnvValueType<ReturnType, DataType>\n    }\n\n    const { returnType = 'string' } = options ?? {}\n\n    const converter = CONVERT_TYPE_MAP[returnType]\n\n    return converter(localStorage.getItem(key) ?? '') as EnvValueType<\n        ReturnType,\n        DataType\n    >\n}\n\nconst clearLocalStorage = (key: LOCAL_STORAGE_NAME) => {\n    if (!key) {\n        log.error('clearLocalStorage: key 不存在')\n        return false\n    }\n\n    localStorage.removeItem(key)\n\n    return true\n}\n\nconst clearAllLocalStorage = () => {\n    localStorage.clear()\n    return true\n}\n\nconst saveSessionStorage = (\n    data: StorageDataKey<string>,\n    // config?,\n) => {\n    const { key, value } = data\n\n    if (!key) {\n        log.error('saveSessionStorage: key 不存在')\n        return\n    }\n\n    sessionStorage.setItem(key, value)\n}\n\nconst getSessionStorage = (key: string) => {\n    if (!key) {\n        log.error('getSessionStorage: key 不存在')\n        return ''\n    }\n\n    return sessionStorage.getItem(key) ?? ''\n}\n\nexport default {\n    // localStorage\n    saveLocalStorage,\n    saveBatchLocalStorage,\n    getLocalStorage,\n    clearLocalStorage,\n    clearAllLocalStorage,\n\n    // sessionStorage\n    saveSessionStorage,\n    getSessionStorage,\n}\n"],"sourceRoot":""}